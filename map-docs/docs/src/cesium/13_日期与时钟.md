# ğŸŒŒ Cesium ä¸­çš„ JulianDateï¼ˆå„’ç•¥æ—¥æœŸï¼‰å’Œ Clockï¼ˆæ—¶é’Ÿï¼‰

## ä»€ä¹ˆæ˜¯å„’ç•¥æ—¥æœŸï¼Ÿ

JulianDate æ˜¯ Cesium æ—¶é—´ç³»ç»Ÿçš„åŸºçŸ³ï¼Œé‡‡ç”¨**å¤©æ–‡å­¦å„’ç•¥æ—¥**æ¦‚å¿µï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

- **è¿ç»­æ— é—´æ–­**ï¼šä¸å­˜åœ¨å†æ³•ä¸è¿ç»­é—®é¢˜ï¼ˆå¦‚é—°å¹´ã€é—°ç§’ï¼‰
- **é«˜ç²¾åº¦å­˜å‚¨**ï¼šåˆ†ç¦»æ—¥å’Œç§’æ•°å­˜å‚¨ï¼Œé¿å…æµ®ç‚¹ç²¾åº¦æŸå¤±
- **æ—¶åŒºæ— å…³æ€§**ï¼šä»¥ UTC æ—¶é—´ä¸ºåŸºå‡†ï¼Œé¿å…æ—¶åŒºæ··ä¹±
- **ç§‘å­¦æ ‡å‡†**ï¼šç¬¦åˆå›½é™…å¤©æ–‡å­¦è”åˆä¼šæ ‡å‡†

### æ—¶é—´è¡¨ç¤ºç»“æ„

```js
{
  day: 2460830,      // æ•´æ•°éƒ¨åˆ† - ä»å„’ç•¥æ—¥èµ·å§‹æ—¥ç®—èµ·çš„å¤©æ•°
  secondsOfDay: 43200 // å°æ•°éƒ¨åˆ† - å½“å¤©å·²è¿‡å»çš„ç§’æ•°ï¼ˆ0-86400ï¼‰
}
```

## JulianDate ä¸å¸¸è§„æ—¥æœŸçš„è½¬æ¢

```js
new Cesium.JulianDate(julianDayNumber, secondsOfDay, timeStandard);
```

| åç§°              | æè¿°                                                    |
| ----------------- | ------------------------------------------------------- |
| `julianDayNumber` | å„’ç•¥æ—¥æ•°ï¼Œè¡¨ç¤ºæ•´å¤©æ•°                                    |
| `secondsOfDay`    | å½“å‰å„’ç•¥æ—¥æ•°çš„ç§’æ•°                                      |
| `timeStandard`    | å®šä¹‰å‰ä¸¤ä¸ªå‚æ•°çš„æ—¶é—´æ ‡å‡†ï¼Œé»˜è®¤`Cesium.TimeStandard.UTC` |

### JulianDate ä¸åŒ—äº¬æ—¶é—´

JulianDate æœ¬èº«ä¸æ¶‰åŠæ—¶åŒºæ¦‚å¿µï¼Œå®ƒå­˜å‚¨çš„æ˜¯ UTC æ—¶é—´ï¼Œè½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´éœ€é€šè¿‡`addHours`æ·»åŠ  8 å°æ—¶åç§»ã€‚

```js
// åˆ›å»ºå½“å‰æ—¶é—´å¯¹åº”çš„ JulianDate
const julianDate = Cesium.JulianDate.fromDate(new Date());
// å°† JulianDate è½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´
const beijingDate = Cesium.JulianDate.addHours(
  julianDate,
  8,
  new Cesium.JulianDate()
);
```

### å¸¸è§„æ—¥æœŸ â†’ JulianDate

#### ä»å½“å‰æ—¶é—´åˆ›å»º

```js
// åˆ›å»ºå½“å‰æ—¶é—´çš„JulianDateï¼ˆæ¨èï¼‰
const nowJulian = Cesium.JulianDate.now();

// ä»JavaScript Dateåˆ›å»º
const jsDate = new Date();
const fromJsDate = Cesium.JulianDate.fromDate(jsDate);
```

#### ä» ISO 8601 å­—ç¬¦ä¸²åˆ›å»º

```js
// ä»ISO 8601å­—ç¬¦ä¸²åˆ›å»ºï¼ˆUTCæ—¶é—´ï¼‰
const isoString = "2025-06-04T12:00:00Z"; // Zè¡¨ç¤ºUTCæ—¶é—´
const fromIso = Cesium.JulianDate.fromIso8601(isoString);

// å¸¦æ—¶åŒºçš„ISOå­—ç¬¦ä¸²ï¼ˆä¼šè‡ªåŠ¨è½¬æ¢ä¸ºUTCï¼‰
const localIsoString = "2025-06-04T20:00:00+08:00"; // åŒ—äº¬æ—¶é—´
const fromLocalIso = Cesium.JulianDate.fromIso8601(localIsoString);
```

### JulianDate â†’ å¸¸è§„æ—¥æœŸ

#### è½¬æ¢ä¸º JavaScript Date

```js
const julianDate = Cesium.JulianDate.now();

// è½¬æ¢ä¸ºJavaScript Dateï¼ˆä¼šä¸¢å¤±çº³ç§’ç²¾åº¦ï¼‰
const jsDate = Cesium.JulianDate.toDate(julianDate);
```

#### æ ¼å¼åŒ–ä¸º ISO 8601 å­—ç¬¦ä¸²

```js
const julianDate = Cesium.JulianDate.now();

// æ ¼å¼åŒ–ä¸ºISO 8601å­—ç¬¦ä¸²ï¼ˆUTCï¼‰
const isoString = Cesium.JulianDate.toIso8601(julianDate);
// è¾“å‡º: "2025-06-04T12:00:00.000Z"

// å¸¦æ¯«ç§’ç²¾åº¦
const isoWithMs = Cesium.JulianDate.toIso8601(julianDate, 3);
// è¾“å‡º: "2025-06-04T12:00:00.500Z"ï¼ˆå‡è®¾500msï¼‰
```

## æ—¶é—´æ“ä½œå®ç”¨å‡½æ•°

| æ–¹æ³•å       | æè¿°       |
| ------------ | ---------- |
| `addDays`    | å¢åŠ å¤©æ•°   |
| `addHours`   | å¢åŠ å°æ—¶æ•° |
| `addMinutes` | å¢åŠ åˆ†é’Ÿæ•° |
| `addSeconds` | å¢åŠ ç§’æ•°   |

### å¢åŠ æ—¶é—´

```js
const baseDate = Cesium.JulianDate.fromIso8601("2025-06-04T12:00:00Z");
const result = new Cesium.JulianDate();

// å¢åŠ 1å¤©3å°æ—¶30åˆ†é’Ÿ
const newDate = Cesium.JulianDate.addDays(baseDate, 1, result);
Cesium.JulianDate.addHours(newDate, 3, result);
Cesium.JulianDate.addMinutes(result, 30, result);

console.log(Cesium.JulianDate.toIso8601(result));
// è¾“å‡º: "2025-06-05T15:30:00Z"
```

### å‡å°‘æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿæ•°ï¼‰

```js
const baseDate = Cesium.JulianDate.fromIso8601("2025-06-04T12:00:00Z");
const result = new Cesium.JulianDate();

// å‡å°‘2å°æ—¶
Cesium.JulianDate.addHours(baseDate, -2, result);
console.log(Cesium.JulianDate.toIso8601(result));
// è¾“å‡º: "2025-06-04T10:00:00Z"
```

## Cesium ä¸­çš„æ—¶é’Ÿ Clock

Clock ä½œä¸ºæ—¶é—´æ¨è¿›å¼•æ“ï¼Œå…¶å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š

1. **åˆå§‹åŒ–**ï¼šè®¾ç½® startTimeã€stopTime å’Œåˆå§‹ currentTime
2. **æ¨è¿›**ï¼šæ ¹æ® clockStep å’Œ multiplier è®¡ç®—æ–°æ—¶é—´
3. **è¾¹ç•Œæ£€æŸ¥**ï¼šæ ¹æ® clockRange å¤„ç†è¾¹ç•Œè¡Œä¸º
4. **äº‹ä»¶è§¦å‘**ï¼šè°ƒç”¨ onTick ç›‘å¬å™¨

```js
new Cesium.Clock(options);
```

| å±æ€§            | ç±»å‹       | è¯´æ˜                                                                            |
| --------------- | ---------- | ------------------------------------------------------------------------------- |
| `currentTime`   | JulianDate | å½“å‰åœºæ™¯æ—¶é—´ï¼ˆå¯è¯»å†™ï¼‰                                                          |
| `startTime`     | JulianDate | æ—¶é—´è½´èµ·å§‹æ—¶é—´                                                                  |
| `stopTime`      | JulianDate | æ—¶é—´è½´ç»“æŸæ—¶é—´                                                                  |
| `multiplier`    | Number     | æ—¶é—´æµé€å€ç‡ï¼ˆæ­£=æ­£å‘æ’­æ”¾ï¼Œè´Ÿ=å€’æ”¾ï¼‰                                            |
| `clockStep`     | ClockStep  | åˆ¤æ–­å¯¹æ¯ä¸€å¸§çš„è°ƒç”¨æ˜¯å¦ä¾èµ–äºå¸§æˆ–ç³»ç»Ÿæ—¶é’Ÿã€‚                                      |
| `clockRange`    | ClockRange | åˆ°è¾¾æ—¶é—´è¾¹ç•Œçš„è¡Œä¸ºï¼šUNBOUNDEDï¼šä¸åœæ­¢ï¼ŒCLAMPEDï¼šåœæ­¢åœ¨è¾¹ç•Œï¼ŒLOOP_STOPï¼šå¾ªç¯æ’­æ”¾ |
| `shouldAnimate` | Boolean    | æ˜¯å¦è‡ªåŠ¨æ’­æ”¾ï¼ˆtrue=æ’­æ”¾ï¼Œfalse=æš‚åœï¼‰                                           |

### ClockStep å±æ€§

`ClockStep` å†³å®šæ—¶é—´å¦‚ä½•å‰è¿›ï¼š

| ClockStep å€¼              | è¯´æ˜             | é€‚ç”¨åœºæ™¯      |
| ------------------------- | ---------------- | ------------- |
| `SYSTEM_CLOCK`            | ä¸ç³»ç»Ÿæ—¶é—´åŒæ­¥   | å®æ—¶æ¨¡æ‹Ÿ      |
| `SYSTEM_CLOCK_MULTIPLIER` | ç³»ç»Ÿæ—¶é—´ Ã— å€ç‡  | åŠ é€Ÿ/å‡é€Ÿæ¨¡æ‹Ÿ |
| `TICK_DEPENDENT`          | æ¯å¸§å‰è¿›å›ºå®šæ—¶é—´ | ç²¾ç¡®æ§åˆ¶åŠ¨ç”»  |

### ClockRange å±æ€§

`ClockRange` æ§åˆ¶åˆ°è¾¾è¾¹ç•Œæ—¶çš„è¡Œä¸ºï¼š

| ClockRange å€¼ | è¯´æ˜             | é€‚ç”¨åœºæ™¯     |
| ------------- | ---------------- | ------------ |
| `UNBOUNDED`   | ä¸å—é™åˆ¶ç»§ç»­å‰è¿› | æ— è¾¹ç•Œæ—¶é—´   |
| `CLAMPED`     | åœåœ¨è¾¹ç•Œ         | å›ºå®šåŒºé—´åŠ¨ç”» |
| `LOOP_STOP`   | å¾ªç¯æ’­æ”¾         | é‡å¤åŠ¨ç”»     |

### åŸºç¡€é…ç½®

```js
const clock = new Cesium.Clock({
  startTime: Cesium.JulianDate.fromIso8601("2023-01-01T00:00:00Z"),
  currentTime: Cesium.JulianDate.fromIso8601("2023-01-01T12:00:00Z"),
  stopTime: Cesium.JulianDate.fromIso8601("2023-01-02T00:00:00Z"),
  clockRange: Cesium.ClockRange.LOOP_STOP, // å¾ªç¯æ’­æ”¾
  multiplier: 2.0, // 2å€é€Ÿæ’­æ”¾
  clockStep: Cesium.ClockStep.SYSTEM_CLOCK,
});

// åœ¨ Viewer ä¸­ä½¿ç”¨
const viewer = new Cesium.Viewer("cesiumContainer", {
  clock: clock,
  shouldAnimate: true, // æ’­æ”¾
});
```

### åŠ¨æ€æ§åˆ¶

```js
// æ’­æ”¾/æš‚åœ
viewer.clock.shouldAnimate = !viewer.clock.shouldAnimate;

// è°ƒæ•´æ’­æ”¾é€Ÿåº¦
viewer.clock.multiplier = 4.0; // 4å€é€Ÿ

// å€’æ”¾
viewer.clock.multiplier = -1.0; // å€’æ”¾

// è·³è½¬åˆ°ç‰¹å®šæ—¶é—´
const targetTime = Cesium.JulianDate.fromIso8601("2025-06-04T18:00:00Z");
Cesium.JulianDate.clone(targetTime, viewer.clock.currentTime);

// é‡ç½®æ—¶é’Ÿ
viewer.clock.currentTime = Cesium.JulianDate.clone(viewer.clock.startTime);
```
